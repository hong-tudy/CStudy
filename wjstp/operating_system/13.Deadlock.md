[!참고용 노션](https://striped-beechnut-dfe.notion.site/432ec39934f74178a305aece050a01bb?pvs=4)
# 교착 상태



# 1. 교착상태란

## 교착 상태의 의미

### 의미

일어나지 않을 사건을 기다리며 진행이 멈춰버리는 상태

### 사례

(1) **뮤텍스락에서의 교착상태**

```cpp
// process1은 임계구역을 지나고 나서 lock1을 잠금 해제하는데,
// 이를 위해서는 lock2가 잠금 해제가 되어야 한다.
// process2는 임계구역을 지나고 나서 lock2를 잠금 해제하는데,
// 이를 위해서는 lock1이 잠금 해제가 되어야 한다.

// process 1
lock1 = true ;
while (lock2 == true) ;
// 임계 구역 진입
lock1 = false;

// process 2
lock2 = true;
while (lock1 = true) ;
// 임계 구역 진입
lock2 = false;
```

(2) **식사하는 철학자 문제 (Dining philosophers problem)**

- 철학자들의 식사 순서
    - 왼쪽 포크가 사용가능할 때 왼쪽 포크를 든다.
    - 오른쪽 포크가 사용가능할때 오른쪽 포크를 든다.
    - 양쪽 포크 모두를 들었을 때 정해진 시간 동안 식사를 한다.
    - 식사 후 오른쪽 포크를 내려놓는다.
    - 그 다음 왼쪽 포크를 내려놓는다.
- 문제 상황
    - 모든 철학자가 식사를 하기 위해 왼쪽 포크를 집어들었다면?
        
        → 모든 철학자들은 식사를 할 수 없다.
        

## 자원 할당 그래프

### 표현 방식

- 도형
    - 프로세스 : 원
    - 자원 : 사각형
    - 사용가능한 자원의 수 : 사각형 내의 점
- 화살표 방향
    - 사각형 → 원 : 특정 프로세스가 해당 자원을 할당받고 있음
    - 원 → 사각형 : 특정 프로세스가 해당 자원을 기다리고 있음
- 특징
    - 교착 상태가 발생할 경우  자원 할당 그래프는 원의 형태를 띈다.
    - 원의 형태를 띄었다고 무조건 교착 상태인 것은 아니다.

## 교착 상태 발생 조건

조건 네 가지를 모두 만족해야 교착 상태가 발생한다. 하나라도 충족하지 않아야 교착 상태가 발생하지 않는다.

### 상호배제

한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없다.

### 점유와 대기

자원을 할당받은 상태에서 다른 자원을 기다리는 상태

### 비선점

어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하는 상황

### 원형 대기

프로세스들과 프로세스가 요청 및 할당 받은 자원이 원의 형태를 이루고 있는 상황

# 2. 교착 상태 해결방법

## (1) 교착 상태 예방

교착 상태가 발생하지 않게 교착 상태 발생 조건에 부합하지 않도록 하는 것

### 상호 배제 x → 현실적으로 불가능

### 점유와 대기 x

- 필요한 자원을 모두 사용하거나 모두 사용하지 않는 방식
- 자원의 활용률이 낮아질 수 있음
- 많은 자원을 사용하는 프로세스가 불리해진다. → 기아 현상 야기
    - 자원을 적게 사용하는 프로세스에 비해 동시에 모든 자원을 사용할 타이밍 확보하기가 어려워진다.

### 비선점 조건 x

- 범용성이 떨어진다.
    - 선점이 가능한 일부 자원(ex. cpu) 에는 효과적이다.
    - 선점이 불가능한 자원 (ex. 프린터) 에는 사용할 수 없는 방법이다.

### 원형 대기 조건 x

- 모든 자원에 번호를 붙이고 순서대로 자원 할당
- 모든 자원에 번호를 붙이는 일이 쉽지않고, 그 순서에 따라 자원의 활용률이 매우 달라진다.

## (2) 교착 상태 회피

### **문제인식**

한정된 자원의 무분별한 할당 → 교착 상태가 발생하지 않을 정도로만 자원할당하자.

→ 안전상태를 유지하도록 자원을 할당하는 방식

### 용어

(1) 안전 상태 (safe state)

정상적으로 자원을 할당받고 종료할 수 있는 상태.

→ 안전순서열 대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태

(2) 불안전 상태(unsafe state)

교착 상태가 발생할 수도 있는 상황

→ 안전순서열이 없는 상태

(3) 안전 순서열(safe sequence)

교착 상태 없이 안전하게 프로세스들이 자원을 할당할 수 있는 순서

## (3) 교착 상태 검출 후 회복

교착 상태 발생을 인정한 후 사후에 조치하는 방식

### 선점을 통한 회복

교착 상태가 해결될때까지 한 프로세스씩 자원을 몰아주는 방식

### 프로세스 강제 종료를 통한 회복

교착 상태에 있는 프로세스를 모두 강제종료 or 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료

- 특징
    - 가장 단순하면서 확실한 방식
    - 모두 강제 종료 하는 방식 → 프로세스들이 작업내역을 잃게 될 가능성이 있음
    - 한 프로세스씩 강제 종료 하는 방식 → 교착 상태 없어졌는지 여부를 확인할 떄 오버헤드 야기

## 참고 :  교착 상태 무시

잠재적 문제를 무시로 대처하는 방법

- 관련 알고리즘 : 타조 알고리즘
- 활용도 : 문제 발생의 빈도나 심각성에 따라 효율을 고려할 때 적절할 수도 있는 방법이다.