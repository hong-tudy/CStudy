### 교착상태란

- 프로세스를 실행하기 위해서는 자원이 필요한데, 두 개 이상의 프로세스가 각자 가지고 있는 자원을 무작정 기다린다면 그 어떤 프로세스도 더이상 진행할 수 없는 교착 상태가 됨
- 일어나지 않을 사건을 기다리며 진행이 멈춰버리는 현상

### 식사하는 철학자 문제

- 동그란 원탁에 다섯 명의 철학자가 앉아 있고 철학자들 사이에 포크가 있고 식사가 있을 때, 모든 철학자가 동시에 포크를 집어 식사를 하면 어떤 철학자도 식사를 할 수 없고 영원히 생각만 해야하는 상황이 발생
    - 철학자는 프로세스 or 스레드
    - 포크는 임계 구역

### 자원 할당 그래프

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/rfhTr/btqEOaRIRIF/Pf7sJGboKDTWhvnkFDKxH0/img.png)

- 교착 상태가 발생한 상황은 자원 할당 그래프가 원의 형태를 띄고 있음

![img1.daumcdn.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/85131cd9-96c2-42f7-9b90-ada271862e1d/b6aee5c3-50d6-4f59-9601-8d6730bdf608/img1.daumcdn.png)

- **따라서, 사이클이 있어도 항상 교착상태가 존재하는 것이 아님을 알 수 있음**

### 교착 상태 발생 조건

- 하나라도 만족하지 않는다면 교착 상태가 발생하지 않음
- 상호 배제
    - 한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없을 때
- 점유와 대기
    - 자원을 할당받은 상태에서 다른 자원을 할당 받기를 기다리는 상태일 때
- 비선점
    - 어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못했을 때
- 원형 대기
    - 프로세스들과 프로세스가 요청 및 할당받은 자원이 원의 형태일 때
        - 자원 할당 그래프가 원의 형태로 그려짐

## 교착 상태 해결 방법

- 예방
- 회피
- 검출 후 회복

### 교착 상태 예방

- 교착 상태 발생 필요 조건 네 가지 중 하나를 충족하지 못하게 하는 방법과 같음
    - 상호 배제
        - 모든 자원을 공유 가능하기 만든다는 말과 같음
        - 이론적으로 교착 상태를 없앨 수 있지만 모든 자원의 상호 배제를 없애기는 어려움
    - 점유와 대기
        - 식사하는 철학자 문제에서 한손에 포크를 들고 다른 포크를 기다리지 못하게 하는 것
        - 포크를 두 개 동시에 들게 하거나 아예 들지 못하게 하는 것
        - 이론적으로는 교착 상태를 해결하지만 자원 활용률이 낮아지고 많은 자원을 사용하는 프로세스가 불리해지는 단점 존재
            - 자원을 많이 사용하는 프로세스는 자원을 적게 사용하는 프로세스에 비해 동시에 자원을 사용할 타이밍을 확보하기 어려움 → 무한정 기다리게 되는 기아 현상을 야기할 우려
    - 비선점 조건
        - 자원을 이용 중인 프로세스로부터 해당 자원을 빼앗기
        - 선점하여 사용할 수 있는 일부 자원에 대해서 효과적
            - CPU
        - 모든 자원이 선점 가능하지는 않음 → 다소 범용성이 떨어짐
            - 프린트 자원
    - 원형 대기
        - 모든 자원에 번호를 붙이고 오름차순으로 자원을 할당하면 원형 대기는 발생하지 않음
        - 앞선 세 방식에 비해 비교적 현실적이고 실용적인 방식이지만 단점 존재
            - 모든 컴퓨터 시스템 내에서 존재하는 수많은 자원에 번호를 붙이는 것은 간단한 작업이 아님
            - 각 자원에 어떤 번호를 붙이는지에 따라 특정 자원의 활용률이 떨어짐
- 교착 상태의 발생 조건을 원천적으로 제거하는 예방 방식은 교착 상태가 발생하지 않음을 보장하지만 부작용이 따름
- 대부분의 교착 상태 방지 알고리즘은 4번 조건, 대기 상태의 사이클이 발생하는 일을 막는데 초점을 맞춤

### 교착 상태 회피

- 교착 상태가 발생하지 않을 정도로 조심 조심 자원을 할당하는 방식
- 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주
- 식사하는 철학자 문제에서 포크의 양이 1000개 일 때, 한 두개의 포크를 요구하면 교착 상태는 발생하지 않음
- 안전 상태
    - 교착 상태가 발생하지 않고 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
- 불안전 상태
    - 교착 상태가 발생할 수도 있은 상황
- 안전 순서열
    - 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미
    - 안전 순서열대로 프로세스들에 자원을 배분하여 교착 상태가 발생하지 않는 상태를 안전 상태
- 운영체제가 교착 상태를 회피하기 위해서는 시스템 상태가 안전 상태에서 안전 상태로 움직이는 경우에만 자원을 할당하면 됨

### 교착 상태 검출 후 회피

- 교착 상태 발생을 인정하고 사후에 조치하는 방식
- 운영체제는 프로세스들이 자원을 요구할 때 마다 그때그때 모두 할당하며, 교착 상태 발생 여부를 주기적으로 검사, 검출되면 회복
- 선점을 통한 회복
    - 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
    - 다른 프로세스로부터 자원을 강제로 빼앗고 한 프로세스에 할당
- 프로세스 강제 종료를 통한 회복
    - 가장 단순하면서 확실한 방식
    - 교착 상태에 놓인 프로세스를 모두 강제 종료할 수도 있음
        - 한 방에 교착 상태를 해결할 수 있는 가장 확실한 방식이지만 그만큼 많은 프로세스들이 작업 내역을 잃게 될 가능성이 있음
    - 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료할 수 있음
        - 작업 내역을 잃는 프로세스는 최대한 줄일 수 있지만 교착 상태가 없어졌는지 여부를 확인하는 과정에서 오버헤드를 야기

### 타조 알고리즘

- 드물게 발생하는 잠재적 문제를 무시로 대처하는 방식
- 문제 발생 빈도나 심각성에 따라 최대 효율을 추구하는 엔지니어 입장에서는 이 방법이 적합할 때도 많음