## 운영체제를 알아야 하는 이유

### 운영체제란?

- 모든 프로그램은 하드웨어를 필요
- 프로그램 실행에 마땅히 필요한 요소들을 가리켜 시스템 자원, 혹은 줄여서 자원이라 함
- 실행할 프로그램에 필요한 자원을 할당하고, 프로그램이 올바르게 실행되도록 돕는 프로그램
- 컴퓨터가 부팅될 때 메모리 내 커널 영역이라는 공간에 따로 적재되어 실행
    - 커널 영역을 제외한 나머지 영역, 사용자가 이용하는 응용 프로그램이 적재되는 영역을 사용자 영역이라 함
    - 응용 프로그램: 사용자가 특정 목적을 위해 사용하는 일반적인 프로그램
        - 워드 프로세서, 인터넷 브라우저, 메모장 등

### 운영체제가 하는 일

- 각각의 응용 프로그램이 메모리 주소가 겹치지 않도록 적당한 공간에 프로그램 적재, 더 이상 실행되지 않는 프로그램을 메모리에서 삭제하며 지속적인 관리
- 각각의 응용 프로그램이 실행되려면 반드시 CPU가 필요
- 공정하게 여러 프로그램에 CPU 자원 할당

**응용 프로그램과 하드웨어 사이에서 응용 프로그램에 필요한 자원을 할당하고 응용 프로그램이 올바르게 실행되도록 관리하는 역할**

## 운영체제의 큰 그림

### 운영체제의 심장, 커널

- 운영체제의 핵심 서비스를 담당하는 부분
- 커널에 포함되지 않는 서비스
    - 사용자 인터페이스 : 사용자가 컴퓨터와 상호작용할 수 있는 통로
        - 그래픽 유저 인터페이스(GUI: Graphical User Interface) : 그래픽을 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스
        - 커맨드 라인 인터페이스(CLI: Command Line Interface) : 명령어 기반으로 컴퓨터와 상호작용할 수 있는 인터페이스
- 종류
    - 단일형 커널
    - 마이크로커널
    - 혼합형 커널

### 이중 모드

- CPU가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분하는 방식
    - 사용자 모드
        - 운영체제 서비스를 제공받을 수 없는 실행 모드
        - 일반적인 응용 프로그램이 실행
        - 입출력 명령어와 같이 하드웨어 자원에 접근하는 명령어를 실행할 수 없음
    - 커널 모드
        - 운영체제 서비스를 제공받을 수 있는 실행 모드
        - 커널 영역의 코드를 실행할 수 있음

### 시스템 호출

- 운영체제 서비스를 제공받기 위한 요청(시스템 콜)
- 사용자 모드로 실행되는 프로그램이 자원에 접근하는 운영체제 서비스를 제공받으려면 운영체제에 요청을 보내 커널 모드로 전환
- 일종의 소프트웨어적인 인터럽트
    - 인터럽트 : CPU가 프로그램을 실행 중일 때 입출력 장치에 의한 예외상황이 발생한 경우, 프로세스를 중단하고 마이크로 프로세스를 통해 처리하는 것을 의미
        - 하드웨어 인터럽트
            - 전원 이상(Power fail interrupt)
            - 기계 고장(Machine Check interrupt)
            - 키보드/마우스/프린트/저장장치 등 입출력(I/O interrupt)
            - 외부 신호(External interrupt)
        - 소프트웨어 인터럽트
            - 프로세스의 잘못된 명령어
            - 시스템 콜
- 처리 순서
    1. 시스템 호출을 발생시키는 명령어 실행
    2. CPU 지금까지의 작업 백업
    3. 커널 영역 내에 시스템 호출을 수행하는 코드(인터럽트 서비스 루틴)를 실행
    4. 기존에 실행하던 응용 프로그램으로 복귀하여 실행을 계속
- 응용 프로그램은 실행 과정에서 운영체제 서비스들을 빈번하게 이용하기 때문에 시스템 콜을 빈번하게 발생, 사용자 모드 ↔ 커널모드

### 운영체제의 핵심 서비스

- 프로세스 관리
    - 메모리에 적재된 실행 중인 프로그램
    - 일반적으로 하나의 CPU는 한 번에 하나의 프로세스만 실행할 수 있기에 CPU는 프로세스들을 조금씩 번갈아 가며 실행
    - 다양한 프로세스를 관리하고 실행할 수 있어야 함
    - 여러 프로세스가 동시에 실행되는 환경에서는 **프로세스 동기화**가 필수, **교착 상태**를 해결해야 함
        - 프로세스 동기화 : 여러 프로세스가 동시에 실행될 때, 공유 자원에 대한 접근을 올바르게 조정하여 일관성과 데이터 무결성을 유지하는 기술
            - 임계 구역
            - 상호 배제
            - 진행 조건
            - 한정 대기
        - 교착 상태 : 여러 프로세스가 서로가 가진 자원을 기다리면서 무한히 대기하는 상태
        - 교착 상태의 조건
            - 상호 배제
            - 점유 및 대기
            - 비선점
            - 순환 대기
- 자원 접근 및 할당
    - 모든 프로세스는 실행을 위해 자원을 필요
        - CPU, 메모리, 보조기억장치, 입출력장치
    - CPU
        - 하나의 CPU는 한 번에 하나의 프로세스만 실행 가능
        - 하나의 프로세스가 CPU를 사용하고 있으면 다른 프로세스는 기다려야함
        - 어떤 프로세스부터 CPU를 이용하게 할지, 얼마나 오래 CPU를 이용하게 할지 결정할 수 있어야 함
            - CPU 스케줄링
    - 메모리
        - 메모리에 적재된 프로세스들은 크기, 적재되는 주소가 제각각
        - 같은 프로세스라 해도 실행될때마다 적재되는 주소 다름
        - 운영체제는 새로운 프로세스가 적재될 때마다 어느 주소에 적재해야 할지를 결정
            - 어떻게 할당하는지, 부족할 경우 어떻게 극복하는지
    - 입출력장치
        - 인터럽트 서비스 루틴은 운영체제가 제공하는 기능
        - 입출력장치가 CPU에 하드웨어 인터럽트 요청 신호를 보내면 CPU는 하던 일을 잠시 백업한 뒤 커널 영역에 있는 인터럽트 서비스 루틴을 실행
    - 파일 시스템 관리
        - 운영체제가 지원하는 핵심 서비스

### 가상 머신과 이중 모드의 발전

- 가상 머신을 통한 가상화를 지원하는 현대 CPU는 커널 모드, 사용자 모드의 두 가지 모드 이상을 지원
- 가상 머신
    - 소프트웨어적으로 만들어낸 가상 컴퓨터
    - 가상 머신을 설치하면 새로운 운영체제와 응용 프로그램을 설치하고 실행
        - 이때 가상 머신은 응용 프로그램으로 가상 머신 상에 설치된 운영체제까지 사용자 모드로 작동
    - 가상화를 지원하는 CPU는 커널 모드와 사용자 모드 이외의 가상 머신을 위한 모드인 하이퍼바이저 모드 존재
        - 가상 머신 상에서 작동하는 응용 프로그램은 하이퍼바이저 모드로써 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받음

### 시스템 호출의 종류

- 유닉스, 리눅스 등의 운영체제(POSIX 운영체제)에서 사용하는 대표적인 시스템 호출

| 종류 | 시스템 호출 | 설명 |
| --- | --- | --- |
| 프로세스 관리 | fork() | 새 자식 프로세스 생성 |
|  | execve() | 프로세스 실행(메모리 공간을 새로운 프로그램 내용으로 덮어씌움 |
|  | exit() | 프로세스 종료 |
|  | waitpid() | 자식 프로세스가 종료할 때까지 대기 |
| 파일 관리 | open() | 파일 열기 |
|  | close() | 파일 닫기 |
|  | read() | 파일 읽기 |
|  | write() | 파일 쓰기 |
|  | stat() | 파일 정보 획득 |
| 디렉터리 관리 | chdir() | 작업 디렉터리 변경 |
|  | mkdir() | ㄷ렉터리 생성 |
|  | rmdir() | 비어 있는 디렉터리 삭제 |
| 파일 시스템 관리 | mount() | 파일 시스템 마운트 |
|  | umount() | 파일 시스템 마운트 해제 |
- 개발자가 작성하는 프로그래밍 언어들은 내부적으로 위와 같은 시스템 호출을 통해 실행
    - Ex) C언어 - printf