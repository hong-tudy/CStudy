### IP (인터넷 프로토콜)

- 지정한 IP 주소에 데이터의 조각들을 패킷(Packet)이라는 통신 단위로 최대한 빨리 목적지로 보내는 역할.
- 조각들의 순서가 뒤바뀌거나 일부가 누락되어도 크게 상관하지 않고 보내는데 집중
- 패킷의 순서 보장을 할 수 없고 패킷이 중간에 유실되어도 방안이 없음

### TCP (전송 제어 프로토콜)

- 패킷 데이터 전달을 보증하고 보낸 순서대로 받게 해줌
- 도착한 패킷을 점검하여 줄을 세우고 망가졌거나 빠진 조각을 다시 요청하는 식으로 보증
- 상대방에게 확실하게 데이터를 보내기 위해 3 way 핸드쉐이킹 기법 사용
  - SYN와 ACK라는 TCP 플래그 사용
  - SYN : 접속 요청
  - ACK : 요청 수락
- IP의 문제 보완

### **TCP 3 way handshake**

- 본격적으로 상대 클라이언트와 연결되기 전에가상 연결을 해서 패킷으로 보내서 확인하는 동작
- 과정
  - 클라이언트 → 서버 : SYN패킷
  - 전송서버 → 클라이언트 : SYN + ACK패킷 전송
  - 클라이언트 → 서버: ACK + 데이터 패킷 전송
  - 데이터 패킷 전송
- TCP 데이터 안에 전송 제어, 순서, 정보가 있기 때문에 순서를 제어할 수 있음

### **4-way Handshaking**

- 세션을 종료하기 위해 수행되는 절차
- 과정
  - 클라이언트가 연결을 종료하겠다는 FIN플래그를 전송. **클라이언트는  FIN-WAIT** 상태
  - 서버는 FIN플래그를 받고, 일단 확인메시지 ACK 보내고 자신의 통신이 끝날때까지 기다리는데 이 상태 가 CLOSE_WAIT상태
  - 연결을 종료할 준비가 되면, 연결해지를 위한 준비가 되었음을 알리기 위해 클라이언트에게 FIN플래그를 전송. 서버의 상태는 **LAST-ACK**
  - 클라이언트는 해지준비가 되었다는 ACK를 확인했다는 메시지를 보냄. **클라이언트의 상태가 FIN-WAIT ->TIME-WAIT** 으로 변경
- TIME_WAIT
  - Server에서 FIN을 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인한 재전송 등으로 인해 FIN패킷보다 늦게 도착하는 상황이 발생하면?
  - Client에서 세션을 종료시킨 후 뒤늦게 도착하는 패킷이 있다면 이 패킷은 Drop되고 데이터는 유실
  - 이러한 현상에 대비하여 Client는 Server로부터 FIN을 수신하더라도 일정시간(디폴트 240초) 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정

### **TCP 순서 보장 방법**

- 클라이언트에서 패킷1, 패킷2, 패킷3 순서로 전송
- 서버에서 패킷1, 패킷3, 패킷2 순서로 받음
- 서버에서 패킷2번부터 다시 보내라고 클라이언트에게 요청(TCP 기본 동작)

### TCP/IP 4계층

- 인터넷 프로토콜 스위트(Internet Protocol Suite)로 알려진 인터넷과 대부분의 네트워크에서 사용되는 프로토콜 스택
- 계층 구분을 통해 각 기능들은 서로 간의 간섭을 최소화할 있고 유지와 보수에 편리하다는 이점
  - 구분을 통해 어떤 계층이 문제인지 찾고 보수하는 것이 간편
- L4 응용 계층 (Application Layer)
  - 사용자와 가장 가까운 계층으로 사용자 - 소프트웨어 간소통을 담당하는 계층
  - 웹 프로그래밍을 하면서 흔히 접하는 여러 서버나 클라이언트 관련 응용 프로그램들이 동작하는 계층
  - 응용프로그램끼리의 데이터 송수신
  - 데이터 단위는 Data/Message
  - 예시
    - FTP는 파일 전송을, HTTP는 웹 페이지 전송을, DNS는 도메인 이름을 IP 주소로 변환하는 서비스를 제공
- L3 전송 계층 (Transport Layer)
  - 네트워크 상의 호스트 간 데이터 전송을 담당
  - 통신 노드 간의 데이터 전송 및 흐름에 있어 신뢰성을 보장
  - 데이터 단위 Segment
  - 전송 주소 Port
  - 예시
    - TCP
      - 신뢰성 있는 데이터 전송을 위해 연결 설정, 데이터 확인 및 오류 복구를 포함한 복잡한 제어 기능을 제공
      - 연결 지향형 프로토콜로 패킷에 하나의 오류라도 있으면 재전송을 위해 에러를 복구
    - UDP
      - 단순히 데이터그램을 보내며, 신뢰성이나 순서 보장을 제공하지 않지만 속도가 빠름
      - 패킷을 중간에 잃거나 오류가 발생해도 이에 대처하지 않고 계속해서 데이터를 전송
- L2 인터넷 계층 (Internet Layer)
  - 네트워크 상에서 데이터의 전송을 담당하는 계층으로 서로 다른 네트워크 간의 통신을 가능하게 하는 역할을 수행
  - 데이터 전송을 위한 논리적 주소 및 경로 지정
  - 데이터 단위 Packet
  - 단말을 구분하기 위해 논리적인 주소로 IP 주소를 할당하게 되고 이 **IP 주소**로 네트워크 상의 컴퓨터를 식별하여 주소를 지정
  - 예시
    - IP는 주소 지정과 패킷 라우팅을, ARP는 IP 주소를 MAC 주소로 변환을, ICMP는 네트워크 진단과 오류 메시지 처리를, RARP는 MAC 주소를 IP 주소로 변환을 담당
    - 라우팅
      - 네트워크 내에서 데이터 패킷을 최적의 경로를 따라 목적지로 전달하는 과정
  - 장비
    - 라우터
      - 네트워크끼리 연결하고 데이터를 전송하는 기기
      - 내부의 라우팅 테이블(Routing Table)을 통해 경로 정보를 등록하여 **데이터 전송을 위한 최적의 경로를 찾음**
- L1 네트워크 인터페이스 계층 (Network Interface Layer) = 링크 계층
  - 물리적인 데이터의 전송을 담당하는 계층
  - 같은 네트워크 안에서 데이터가 전송
  - 노드 간의 신뢰성 있는 데이터 전송을 담당
  - 실제 데이터인 프레임 송수신
  - 기본적인 에러 검출과 패킷의 Frame화를 담당
  - 데이터 단위 Frame
  - 전송 주소 MAC
    - 네트워크 인터페이스 컨트롤러(NIC) 또는 네트워크 장치에 할당된 고유 식별자
    - 논리적인 주소가 아닌 물리적인 주소인 MAC을 참조해 장비간 전송
  - 예시
    - LAN, 패킷망
  - 장비
    - 브릿지, 스위치, 네트워크 어댑터(NIC), 허브

### OSI 7계층과의 차이점

![](https://velog.velcdn.com/images/dyunge_100/post/c1fdb43d-7f7e-4613-9526-a15b01fa9546/image.png)

- **OSI 7계층 모델**
  - **개념적 모델**로, 데이터 통신 시스템의 기능을 7개의 계층으로 구분하여 각 계층의 역할을 정확하게 정의
  - 각 계층은 특정한 기능을 담당하며, 상위 계층은 하위 계층의 서비스를 사용. 이 모델은 네트워크 설계 및 이해를 돕기 위한 **이론적 프레임워크**로, 교육과 연구에서 널리 사용
  - **7계층**으로 구성되며, 물리, 데이터 링크, 네트워크, 전송, 세션, 표현, 응용 계층으로 나뉨 각 계층은 명확한 역할을 가지고 있으며, 상호 독립적으로 설계
- **TCP/IP 4계층 모델**
  - **실무적 모델**로, 인터넷 프로토콜 스위트(Internet Protocol Suite). 이 모델은 인터넷과 대부분의 네트워크에서 실제로 사용되는 **프로토콜 중심의 모델**
  - OSI 모델보다 **단순화**된 구조로, 실질적인 네트워크 프로토콜 구현에 초점 인터넷 프로토콜(IP)과 전송 제어 프로토콜(TCP) 등이 이 모델의 핵심
  - **4계층**으로 구성되며, 네트워크 인터페이스(또는 링크) 계층, 인터넷 계층, 전송 계층, 응용 계층으로 나뉨. 이는 실제 네트워크 환경에서 사용되는 프로토콜들의 기능을 기반으로 계층을 나눈 것
- 네트워크 인터페이스 계층
  - OSI 7계층에서 물리 + 데이터링크 계층
  - 알맞은 하드웨어로 데이터가 전달되도록 MAC주소를 핸들링 하는것 뿐 아니라, 데이터 패킷을 전기신호로 변환하여 선로를 통하여 전달할 수 있게 준비
- 인터넷 계층
  - OSI 7계층에서 네트워크 계층
  - IP를 담당하여 데이터의 원천지와 목적지에 대한 정보를 첨부
- 전송 계층
  - OSI 7계층에서 전송 계층
  - **TCP / UDP**를 담당하는 계층
  - 순서가 맞지 않거나 중간에 빠진 부분을 점검하여 다시 요청하는 일을 담당
- 응용 계층
  - OSI 7계층에서 세션, 표현, 응용 계층
  - 서버나 클라이언트 응용 프로그램이 동작

### **TCP / IP 4계층 동작 순서**

![](https://velog.velcdn.com/images/dyunge_100/post/12e91f10-388c-415d-a3bb-8e452f49c6bf/image.png)

- 송신측 클라이언트의 애플리케이션 계층에서 어느 웹 페이지를 보고 싶다라는 HTTP 요청을 지시
- 그 다음에 있는 트랜스포트 계층에서는 애플리케이션 계층에서 받은 데이터(HTTP 메시지)를 통신하기 쉽게 조각내어 안내 번호와 포트 번호(TCP 패킷)를 붙여 네트워크 계층에 전달
- 네트워크 계층에서 데이터에 IP 패킷을 추가해서 링크 계층에 전달
- 링크 계층에서는 수신지 MAC 주소와 이더넷 프레임을 추가
- 네트워크를 통해 송신할 준비
- 수신측 서버는 링크 계층에서 데이터를 받아들여 순서대로 위의 계층에 전달하여 애플리케이션 계층까지 도달
- 수신측 애플리케이션 계층에 도달하게 되면 클라이언트가 발신했던 HTTP 리퀘스트를 수신

### UDP

- 비연결지향적 프로토콜
- 데이터 전달 보증하지 않음
- 순서를 보장하지 않음
- TCP에 비해서 기능이 거의 없어 단순하지만 오로지 빠르게 패킷을 보내는 목적
- IP와 거의 같음, PORT와 체크섬(메세지 검증해주는 데이터) 정도만 추가된 형태
- IP에 기능이 거의 추가되지 않은 상태이기 때문에 최적화 및 커스터마이징이 용이

### TCP Vs UDP

| 특성                   | TCP                              | UDP                                 |
| ---------------------- | -------------------------------- | ----------------------------------- |
| 연결 방식              | 연결지향형 프로토콜              | 비 연결지향형 프로토콜              |
| 데이터 전송 방식       | 바이트 스트림을 통한 연결        | 메세지 스트림을 통한 연결           |
| 혼잡 제어 및 흐름 제어 | 혼잡제어, 흐름제어               | 혼잡제어와 흐름제어 지원 X          |
| 순서 보장              | 순서 보장, 상대적으로 느림       | 순서 보장되지 않음, 상대적으로 빠름 |
| 신뢰성                 | 신뢰성 있는 데이터 전송 - 안정적 | 데이터 전송 보장 X                  |
| 데이터 단위            | 세그먼트 (TCP 패킷)              | 데이터그램 (UDP 패킷)               |
| 사용 예                | HTTP, Email, File transfer       | 도메인, 실시간 동영상 서비스        |

### 네이버 접속 시나리오

1. 웹 브라우저에 www.naver.com 입력
2. DNS로 네이버 서버 IP주소 할당.
3. 응용 계층(L4)에서 메세지 데이터 패킹(HTTP 메시지)
4. 전송 계층(L3)에서 PORT정보(출발지, 목적지), 전송제어 정보, 순서 정보, 검증 정보 패킹 (TCP)
5. 인터넷 계층(L2)에서 IP정보(출발지, 목적지) 패킹
6. 네트워크 엑세스(L1) 계층에서 MAC주소 패킹
7. 게이트웨이를 통해 인터넷망 접속.
8. 라우터를 통해 목적지(네이버 서버)를 찾아 연결.
9. 네이버 서버에 도착하면 패킷을 하나 하나 까면서 목적 포트에 메세지 데이터 전달하여 다시 응답
