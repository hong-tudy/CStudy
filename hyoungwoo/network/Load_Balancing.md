### 개요

- 웹사이트에 접속하는 인원이 급격히 늘어남으로 모든 트래픽을 감당하기엔 1대의 서버로는 부족
- 대응 방안
    - 하드웨어의 성능을 올리기(Scale-Up)
        - 기존 서버의 성능을 향상시키는 방법입니다. 하드웨어의 성능을 업그레이드하여 더 많은 트래픽을 처리할 수 있도록 함
        - 간편하게 시스템 성능을 향상시킬 수 있음
        - 하드웨어의 한계가 있으며, 업그레이드가 한계에 도달하면 더 이상 성능을 향상시킬 수 없음, 다운 타임이 필요할 수 있음
        - 예시
            - CPU, 메모리, 저장 장치 등의 업그레이드
    - 여러 대의 서버가 나눠서 일하도록 만들기 (Scale-Out)
        - 새로운 서버를 추가하여 시스템의 성능을 확장하는 방법
        - 시스템의 성능을 수평적으로 확장할 수 있으며, 필요에 따라 서버를 추가하거나 제거할 수 있어 유연
        - 고가용성을 제공하고, 서버에 장애가 발생하더라도 나머지 서버가 서비스를 계속 유지
        - 서버 관리와 트래픽 분산을 위한 추가적인 인프라와 관리가 필요
        - 예시
            - 웹 서버 클러스터에 새로운 서버 추가
- 하드웨어 향상 비용이 더욱 비싸기도 하고, 서버가 여러대면 무중단 서비스를 제공하는 환경 구성이 용이하므로 Scale-out이 효과적
- 여러 서버에게 균등하게 트래픽을 분산시켜주는 것이 바로 **로드 밸런싱**

### 로드 밸런싱 알고리즘

- 정적 로드 밸런싱
    - 고정된 규칙을 따르며 현재 서버 상태와 무관
    - 라운드 로빈 방식
        - 요청이 들어올 때마다 순서대로 다음 서버에 요청을 할당
        - 서버 리스트가 순환되며, 각 서버가 균등하게 요청을 받음
        - 구현이 간단하고, 서버 서버의 상태나 요청의 특성에 관계없이 일정하게 요청을 분산
        - 서버의 처리 능력이나 현재 부하 상태를 고려하지 않으므로, 성능 차이가 있는 서버에 비효율적으로 요청을 분산
    - 가중 기반 라운드 로빈 방식
        - 각 서버에 가중치를 부여하여 요청을 분배
        - 서버의 성능이나 처리 능력에 따라 가중치를 설정하며, 가중치가 큰 서버에 더 많은 요청을 할당
        - 서버의 처리 능력 차이를 반영하여 요청을 더 효율적으로 분산
        - 서버의 성능을 지속적으로 평가하고 가중치를 조정해야 하며, 가중치 설정이 복잡할 수 있음
    - IP 해시 방식
        - 클라이언트의 IP 주소를 해싱하여 특정 서버에 요청을 할당, 동일한 클라이언트 IP는 항상 같은 서버로 라우팅
        - 동일한 클라이언트의 요청이 같은 서버로 보내지므로 세션 유지와 같은 기능을 구현하기 쉬움
        - 클라이언트 IP 주소 변경이나 서버의 추가/삭제에 따라 로드 밸런싱의 균형이 깨질 수 있음
- 동적 로드 밸런싱
    - 서버의 현재 상태나 부하를 실시간으로 반영하여 요청을 분산
    - 최소 연결 방법
        - 현재 연결 수가 가장 적은 서버에 새로운 요청을 할당
        - 서버의 부하를 기준으로 요청을 분산
        - 서버의 현재 부하 상태를 고려하여 요청을 더 효율적으로 분산, 서버의 연결 수에 따라 부하를 분산
        - 연결 수를 기준으로 하므로, 요청의 처리 시간이 큰 경우에는 부하를 정확히 반영하지 못할 수 있음
    - 가중치 기반 최소 연결 방법
        - 서버에 가중치를 부여하고, 연결 수와 가중치를 결합하여 요청을 분산
        - 서버의 성능과 연결 수를 함께 고려
        - 서버의 성능 차이와 현재 부하 상태를 모두 고려하여 요청을 효율적으로 분산
        - 가중치와 연결 수를 동시에 고려하므로 알고리즘이 복잡해질 수 있음
    - 최소 응답 시간 방법
        - 응답 시간이 가장 짧은 서버에 요청을 할당
        - 각 서버의 응답 속도를 기준으로 요청을 분산
        - 사용자에게 더 빠른 응답을 제공할 수 있음, 서버의 성능과 현재 부하 상태를 반영
        - 응답 시간 측정이 필요하며, 응답 시간이 빠른 서버가 항상 부하가 적은 것은 아님
    - 리소스 기반 방법
        - 서버의 CPU 사용량, 메모리 사용량 등 리소스 사용 상태를 기준으로 요청을 분산
        - 리소스 사용량에 따라 서버를 선택
        - 서버의 실제 리소스 사용 상태를 반영하여 효율적으로 요청을 분산
        - 리소스 사용량 모니터링이 필요하며, 리소스 상태 변화에 따라 서버 선택이 동적으로 조정되어야 함

### 로드 밸런싱의 작동 방식

- 서버 팜
    - 일반적으로 여러 서버에서 애플리케이션을 실행
- 사용자가 애플리케이션에 접근하려고 할 때, 모든 요청이 먼저 **로드 밸런서**로 이동
- 과정
    - 요청 수신
        - 사용자 요청이 로드 밸런서로 전달
    - 서버 선택
        - 로드 밸런서는 요청을 처리할 가장 적합한 서버를 선택
        - 로드 밸런싱 알고리즘을 사용하여 서버를 결정
    - 요청 라우팅
        - 선택된 서버로 요청을 전달하고, 서버는 요청을 처리하여 응답을 반환
    - 응답 전달
        - 로드 밸런서는 서버의 응답을 사용자에게 전달

### **로드 밸런싱 유형**

- 애플리케이션 로드 밸런싱
    - **기능:** HTTP 헤더, SSL 세션 ID 등 요청 콘텐츠를 검사하여 트래픽을 리디렉션
    - **용도:** 복잡한 최신 애플리케이션에 사용되며, 여러 서버 팜이 단일 애플리케이션 기능을 처리
    - **예시:** 전자상거래 애플리케이션에서 제품 검색 요청은 이미지 및 비디오 서버로, 장바구니 요청은 클라이언트 연결을 유지할 수 있는 서버로 전송
- 네트워크 로드 밸런싱
    - **기능:** IP 주소와 기타 네트워크 정보를 기준으로 트래픽을 리디렉션
    - **용도:** IP 기반 트래픽 분산, 고정 IP 주소 할당, 고적 및 동적 로드 밸런싱 알고리즘 사용.
    - **특징:** IP 기반 요청 및 연결을 추적하고, 네트워크 계층에서 로드 분산을 수행
- 글로벌 서버 로드 밸런싱
    - **기능:** 지리적으로 분산된 서버에서 트래픽을 리디렉션
    - **용도:** 여러 데이터 센터와 국가에 걸쳐 서버가 배포된 경우 사용
    - **특징:** 클라이언트와 지리적으로 가까운 서버로 트래픽을 리디렉션하고, 서버 장애 발생 시 지리적으로 먼 서버로 트래픽을 리디렉션
- DNS 로드 밸런싱
    - **기능:** 도메인 이름 시스템(DNS)에서 네트워크 요청을 라우팅
    - **용도:** 도메인을 통해 전 세계적으로 분산된 리소스 풀에서 트래픽을 분산
    - **특징:** 애플리케이션 가용성을 유지하고, DNS 레코드를 기반으로 네트워크 트래픽을 분산

### 로드 밸런싱의 기술 유형

- **하드웨어 로드 밸런서**
    - **설명:** 하드웨어 기반 로드 밸런서는 전용 하드웨어 장비로, 대량의 트래픽을 안정적으로 처리하고, 수백 개의 서버로 요청을 리디렉션
    - **특징:**
        - **전용 장비:** 물리적 장비로서 성능이 높은 하드웨어를 사용하여 트래픽을 처리
        - **고성능:** 수 기가바이트의 트래픽을 처리하며, 대규모 트래픽을 효율적으로 관리
        - **고정 자산:** 장비를 구입하고 설치하는 데 초기 투자 비용이 발생
        - **유지 관리:** 지속적인 유지 관리와 구성 작업이 필요
        - **제한:** 최대 용량으로 사용하지 않거나 피크 시간에만 사용될 수 있으며, 급격한 트래픽 증가 시 추가 장비 구입이 필요할 수 있음
    - **소프트웨어 로드 밸런서**
    - **설명:** 소프트웨어 기반 로드 밸런서는 애플리케이션 형태로 제공되며, 서버에 설치하거나 클라우드 서비스로 액세스할 수 있음
    - **특징:**
        - **유연성:** 쉽게 스케일 업하거나 스케일 다운할 수 있어, 동적인 트래픽 요구에 유연하게 대응
        - **클라우드 호환성:** 최신 클라우드 환경과 잘 호환되며, 클라우드에서 제공하는 관리형 서비스로 사용 가능.
        - **비용 효율성:** 초기 설치 비용이 낮으며, 시간이 지남에 따라 설정, 관리 및 사용하는 데 드는 비용이 줄어듬
        - **설정:** 소프트웨어 업데이트와 관리가 비교적 용이
- **하드웨어 vs. 소프트웨어 로드 밸런서**
    - **하드웨어 로드 밸런서**
        - **장점:** 높은 성능, 안정성, 대규모 트래픽 처리
        - **단점:** 높은 초기 투자 비용, 유지 관리 필요, 유연성 부족
    - **소프트웨어 로드 밸런서**
        - **장점:** 유연성, 비용 효율성, 클라우드 호환성
        - **단점:** 성능이 하드웨어에 비해 낮을 수 있으며, 소프트웨어에 따라 성능 차이가 있음

### L4 로드 밸런싱과 L7 로드 밸런싱

- L4 로드 밸런서
    - 3계층 - 네트워크 계층(IP, IPX)이나 4계층 - 전송 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산
    - IP 주소, 포트번호, MAC 주소, 전송 프로토콜 등에 따라 트래픽을 분산하는 것이 가능
    - 장점
        - 패킷의 내용을 확인하지 않고 로드를 분산하므로 속도가 빠르고 효율이 높음.
        - 데이터의 내용을 복호화할 필요가 없기에 안전
        - L7 로드밸런서보다가격이 저렴.
    - 단점
        - 패킷의 내용을 살펴볼 수 없으므로, 섬세한 라우팅 불가
        - 사용자의 IP가 수시로 바뀌는 경우라면, 연속적인 서비스를 제공하기 어려움.
- L7 로드 밸런서
    - 7 계층 - 어플리케이션 계층(HTTP, FTP, SMTP 등)에서 로드를 분산하기 때문에, HTTP 헤더, 쿠키 등과 같은 사용자 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능
    - L4 로드밸런서의 기능에 더하여, 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능.
    - 특정한 패턴을 지닌 바이러스를 감지해 네트워크 보호 가능.
    - Dos/DDos 와 같은 비정상적인 트래픽 필터링 가능.
    - 방식
        - URL 스위칭(URL Switching) 방식
            - 특정 하위 URL들은 특정 서버로 처리하는 방식.
                - '.../steven/image' => 이미지 처리 서버   /    '.../steven/video' => 동영상 처리 서버
        - 컨텍스트 스위칭(Context Switching) 방식
            - 클라이언트가 요청한 특정 리소스에 대해 특정 서버로 연결 가능.
                - 이미지 파일에 대해서는 확장자를 참조하여, 별도로 구성된 이미지 파일이 있는 서버 or 스토리지로 직접 연결.
        - 쿠키 지속성(Persistence with Cookies)
            - 쿠키 정보를 바탕으로 클라이언트가 연결했었던 동일한 서버에 계속 할당해 주는 방식.
            - 특히, 사설 네트워크에 있던 클라이언트의 IP 주소가 공인 IP 주소로 치환되어 전송하는 방식을 지원.
                - X-Forwarded-For 헤더에 클라이언트 IP 주소를 별도로 기입
    - 장점
        - 상위 계층에서 로드를 분산하기 때문에 훨씬 더 섬세한 라우팅 가능.
        - 캐싱(Cashing) 기능을 제공.
        - 비정상적인 트래픽을 사전에 필터링할 수 있어 서비스 안정성 높음.
    - 단점
        - L4 로드밸런서에 비해 비쌈.
        - 패킷의 내용을 복호화하여야 하므로 더 높은 비용을 지불해야 함.
        - 클라이언트가 로드밸런서와 인증서를 공유해야 하기 때문에, 공격자가 로드밸런서를 통해 클라이언트의 데이터에 접근할 수 있는 보안상의 위험성 존재.
        - 동적인 부하 분산 알고리즘이 복잡하고 관리가 필요함